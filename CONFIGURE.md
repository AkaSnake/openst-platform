## OpenST Platform development installation steps

Document has steps to configure OpenST platform for development and test environments. 
For production environment, following steps are not recommended to avoid single point 
failures and scalability issues caused because of single machine.

You can test platform as standalone system or with Sample RESTful APIs. We have publish 
this document for both kind of setups.

## Installation prerequisite 

* Install node version >= 7
* Install geth version >= 1.7.2 

## Choose the platform flavour
     
#### * Platform as standalone system

* Checkout platform code from repository

```bash
  > git clone git@github.com:OpenSTFoundation/openst-platform.git
  > cd openst-platform
  > export OPENST_PLATFORM_PATH=$(pwd)
```

#### * Platform with Sample RESTful APIs

* Checkout RESTful APIs code from repository

```bash
  > git clone git@github.com:OpenSTFoundation/openst-platform-apis.git
  > cd openst-platform-apis
  > export OPENST_PLATFORM_PATH=$(pwd)/node_modules/@openstfoundation/openst-platform
```

## Start OpenST Platform Setup

* <b>Install all required node modules</b>

```bash
  > npm install
```

* <b>Start the openST platform setup</b>

```bash
  > node $OPENST_PLATFORM_PATH/tools/setup/index.js
```

Setup will create "openst-setup" folder in your HOME folder with following folders and files:

1. openst-geth-value - Acts as ethereum MainNet for development/test environment using POW consensus algorithm.
2. openst-geth-utility - Acts as openST side chain network for development/test environment using POA consensus algorithm.  
3. bin - Contain multiple executables for ethereum chains and platform services
4. logs - Contain logs generated by executables in bin folder
5. openst_env_vars.sh - Platform related environment variables 

```bash
  > ls -alt $HOME/openst-setup/
```

## Register and Mint branded tokens on Platform

#### On Terminal 1 - Start all the required services
* <b>Load platform environment variables</b>

```bash
  > source $HOME/openst-setup/openst_env_vars.sh
```

* <b>Start all platform services in background</b>   
```bash
  > node $OPENST_PLATFORM_PATH/tools/setup/start_services.js
```
Important Note: Wait until all service are up and running. A success message will be displayed when everything is good to go.
Let this script be running while branded tokens are registered and minted.

Note: Script also monitor these services and alert if any required service terminates.

* <b>Optional steps for debugging</b>
  - Listen notification published from platform
  
  ```bash
    > node $OPENST_PLATFORM_PATH/executables/notification_subscribe.js
  ```
  
  - All logs created by different services are present in logs folder
  
  ```bash
    > ls -alt $HOME/openst-setup/logs/
  ```

#### On Terminal 2 - Once all required services are up and running, let's onboard our first branded token

* <b>Load platform environment variables</b>  

```bash
  > source $HOME/openst-setup/openst_env_vars.sh
```

* <b>Onboard/Register Branded Token</b> - Registration requires three input parameters:
1. Name - branded token name (example: "ACME Coin")
2. Symbol - branded token symbol (example: "ACME")
3. Conversion Rate - branded token to OST conversion rate, 1 OST = x BT (example: 10)

```bash
  > node $OPENST_PLATFORM_PATH/tools/setup/branded_token/register.js "ACME Coin" "ACME" 10
```

NOTE: Upon successful registration, branded token details will be published in the branded token configuration file.

```bash
  > cat $HOME/openst-setup/branded_tokens.json
  
  {
    "0x9b8f63ed597ca654262e21647d59f5ef495d173909d7816982d367b85f5ebc76": {
      "Name": "ACME Coin",
      "Symbol": "ACME",
      "ConversionRate": 10,
      "Reserve": "0xEB05083DE29860b912151d93DB24C55b7beB6936", // Branded Token owner address on utility chain
      "ReservePassphrase": "acmeOnopenST",
      "UUID": "0x9b8f63ed597ca654262e21647d59f5ef495d173909d7816982d367b85f5ebc76",
      "ERC20": "0x3B662406CCab34fd2Ce81Bf7154987DDCE82F6EF" // Branded Token EIP20 contract address
    }
  }
```

* <b>Mint branded tokens and get ST' (gas) on utility chain by staking OST</b> - Minting requires 2 input arguments:
1. Symbol - branded token symbol (example: "ACME")
2. Amount - The OST amount in Weis to stake, where 1 OST = (1 X 10^18) OST Wei (example: 500 OST = 500000000000000000000 OST Wei)

```bash
  > node $OPENST_PLATFORM_PATH/tools/setup/branded_token/mint.js "ACME" 500000000000000000000
```

NOTE: Upon successful minting, Branded Token reserve address will receive branded tokens, of worth 
90% of staked OST, and ST' (gas for OpenST utility chain), of worth 10% of staked OST.  

Example: For 500 OST, reserve address will get: 

- 4500 ACME tokens ((90% of 500 staked OST) * (10 as conversion factor))
- 50 ST' ((10% of 500 staked OST) * (1 as conversion factor))
     

#### Back on Terminal 1 - Stop start_services.js script, if you don't want to register and mint more branded tokens on utility chain.

## Start using branded tokens on utility chain

#### For Sample RESTful APIs

* <b>Load platform environment variables</b>  

```bash
  > source $HOME/openst-setup/openst_env_vars.sh
```

* <b>Start geth nodes for both the chains</b>

```bash
  > sh $HOME/openst-setup/bin/run-utility.sh
  > sh $HOME/openst-setup/bin/run-value.sh
```

* <b>Start application server</b>

```bash
  > node app.js
```
* <b>TODO: Use PostMan files</b>

#### For Standalone System

* <b>TODO: Use Services</b>

For complete implementation details of OpenST Platform, please refer [API documentation](http://docs.openst.org/).
